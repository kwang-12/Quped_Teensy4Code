#pragma once
#include <Arduino.h>
#include "globals.h"
#include "ODriveArduino.h"

class jointPositions
{
    public:
    struct joint_pos{
        float fR_knee_pos = 0.0;
        float fR_hip_pos = 0.0;
        float fR_ab_pos = 0.0;
        float fL_knee_pos = 0.0;
        float fL_hip_pos = 0.0;
        float fL_ab_pos = 0.0;
        float bR_knee_pos = 0.0;
        float bR_hip_pos = 0.0;
        float bR_ab_pos = 0.0;
        float bL_knee_pos = 0.0;
        float bL_hip_pos = 0.0;
        float bL_ab_pos = 0.0;
    }joint_pos_target_deg;

    struct joint_velo{
        float fR_knee_velo = 0.0;
        float fR_hip_velo = 0.0;
        float fR_ab_velo = 0.0;
        float fL_knee_velo = 0.0;
        float fL_hip_velo = 0.0;
        float fL_ab_velo = 0.0;
        float bR_knee_velo = 0.0;
        float bR_hip_velo = 0.0;
        float bR_ab_velo = 0.0;
        float bL_knee_velo = 0.0;
        float bL_hip_velo = 0.0;
        float bL_ab_velo = 0.0;
    }joint_vel_target_deg;

    struct joint_initial_pos{
        float fR_knee_pos = 0.0;
        float fR_hip_pos = 0.0;
        float fR_ab_pos = 0.0;
        float fL_knee_pos = 0.0;
        float fL_hip_pos = 0.0;
        float fL_ab_pos = 0.0;
        float bR_knee_pos = 0.0;
        float bR_hip_pos = 0.0;
        float bR_ab_pos = 0.0;
        float bL_knee_pos = 0.0;
        float bL_hip_pos = 0.0;
        float bL_ab_pos = 0.0;
    }joint_initial_pos_deg;

    float jtraj_hip_pos[200] = {39.87,40.20,40.52,40.85,41.17,41.49,41.80,42.11,42.42,42.72,43.02,43.31,43.60,43.89,44.18,44.47,44.76,45.04,45.33,45.61,45.90,
    46.18,46.46,46.73,47.00,47.26,47.52,47.77,48.02,48.26,48.49,48.72,48.95,49.17,49.40,49.62,49.85,50.07,50.30,50.54,50.77,51.01,51.25,51.50,51.74,51.98,52.23,
    52.48,52.73,52.98,53.24,53.52,53.81,54.13,54.47,54.84,55.25,55.70,56.20,56.73,57.31,57.93,58.58,59.25,59.93,60.62,61.30,61.97,62.60,63.19,63.72,64.20,64.60,
    64.94,65.19,65.37,65.47,65.50,65.44,65.32,65.12,64.86,64.54,64.15,63.71,63.21,62.65,62.04,61.38,60.67,59.90,59.09,58.22,57.31,56.34,55.33,54.28,53.19,52.05,
    50.88,49.69,48.46,47.22,45.97,44.71,43.45,42.19,40.94,39.70,38.48,37.28,36.11,34.95,33.82,32.71,31.62,30.56,29.51,28.49,27.49,26.51,25.56,24.65,23.77,22.93,
    22.14,21.41,20.73,20.12,19.59,19.13,18.74,18.43,18.19,18.03,17.94,17.91,17.93,18.01,18.14,18.31,18.50,18.73,18.98,19.26,19.55,19.85,20.17,20.49,20.83,21.18,
    21.54,21.90,22.27,22.65,23.04,23.43,23.82,24.22,24.62,25.02,25.43,25.83,26.23,26.64,27.04,27.44,27.84,28.24,28.64,29.04,29.43,29.82,30.21,30.60,30.98,31.36,
    31.74,32.12,32.49,32.86,33.23,33.59,33.95,34.32,34.68,35.04,35.40,35.76,36.12,36.48,36.83,37.18,37.53,37.88,38.22,38.55,38.88,39.21,39.54};

    float jtraj_hip_velo[200] = {65.48,65.45,65.26,64.84,64.19,63.37,62.44,61.47,60.56,59.74,59.06,58.53,58.14,57.88,57.70,57.58,57.48,57.34,57.14,56.83,56.40,
    55.82,55.09,54.22,53.21,52.10,50.93,49.73,48.55,47.46,46.50,45.72,45.15,44.82,44.73,44.87,45.21,45.71,46.30,46.92,47.51,48.02,48.41,48.68,48.84,48.98,49.19,
    49.60,50.37,51.68,53.70,56.60,60.48,65.42,71.42,78.38,86.16,94.50,103.09,111.56,119.51,126.5,132.13,136.04,137.91,137.55,134.83,129.72,122.31,112.78,101.37,
    88.40,74.22,59.18,43.64,27.92,12.28,-3.040,-17.89,-32.16,-45.79,-58.80,-71.21,-83.10,-94.54,-105.62,-116.42,-127.01,-137.46,-147.79,-158.01,-168.13,-178.09,
    -187.86,-197.33,-206.43,-215.04,-223.04,-230.3,-236.7,-242.13,-246.49,-249.71,-251.74,-252.6,-252.31,-250.96,-248.67,-245.57,-241.84,-237.65,-233.2,-228.63,
    -224.08,-219.62,-215.28,-211.03,-206.79,-202.42,-197.75,-192.58,-186.7,-179.9,-172.02,-162.94,-152.6,-141.03,-128.29,-114.56,-100.03,-84.98,-69.70,-54.50,
    -39.68,-25.52,-12.24,-0.03,11.00,20.78,29.31,36.64,42.87,48.11,52.51,56.21,59.36,62.08,64.47,66.62,68.59,70.42,72.12,73.69,75.13,76.43,77.56,78.52,79.31,
    79.92,80.37,80.66,80.81,80.84,80.79,80.66,80.47,80.24,79.97,79.67,79.34,78.97,78.57,78.13,77.64,77.10,76.54,75.94,75.34,74.75,74.19,73.67,73.23,72.87,72.59,
    72.39,72.24,72.13,72.02,71.85,71.61,71.24,70.73,70.08,69.29,68.43,67.57,66.77,66.14,65.71,65.52};

    float jtraj_knee_pos[200] = {77.28,77.28,77.28,77.28,77.27,77.25,77.23,77.19,77.15,77.10,77.05,76.99,76.92,76.86,76.79,76.72,76.65,76.58,76.50,76.42,76.34,
    76.26,76.17,76.07,75.96,75.85,75.73,75.60,75.46,75.32,75.16,75.01,74.84,74.68,74.51,74.33,74.16,74.00,73.83,73.66,73.50,73.35,73.19,73.04,72.90,72.76,72.62,
    72.50,72.38,72.27,72.19,72.12,72.07,72.06,72.08,72.15,72.27,72.44,72.67,72.97,73.33,73.77,74.27,74.83,75.46,76.15,76.90,77.69,78.52,79.38,80.26,81.16,82.06,
    82.96,83.84,84.72,85.56,86.38,87.17,87.92,88.64,89.32,89.96,90.57,91.13,91.67,92.17,92.65,93.09,93.51,93.90,94.26,94.60,94.90,95.17,95.41,95.60,95.76,95.87,
    95.94,95.97,95.94,95.87,95.76,95.60,95.41,95.17,94.90,94.60,94.26,93.90,93.51,93.09,92.65,92.17,91.67,91.13,90.57,89.96,89.32,88.64,87.92,87.17,86.38,85.56,
    84.72,83.84,82.96,82.06,81.16,80.26,79.38,78.52,77.69,76.90,76.15,75.46,74.83,74.27,73.77,73.33,72.97,72.67,72.44,72.27,72.15,72.08,72.06,72.07,72.12,72.19,
    72.27,72.38,72.50,72.62,72.76,72.90,73.04,73.19,73.35,73.50,73.66,73.83,74.00,74.16,74.33,74.51,74.68,74.84,75.01,75.16,75.32,75.46,75.60,75.73,75.85,75.96,
    76.07,76.17,76.26,76.34,76.42,76.50,76.58,76.65,76.72,76.79,76.86,76.92,76.99,77.05,77.10,77.15,77.19,77.23,77.25,77.27,77.28,77.28,77.28};

    float jtraj_knee_velo[200] = {0,-0.06,-0.44,-1.240,-2.470,-4.020,-5.750,-7.490,-9.120,-10.53,-11.67,-12.53,-13.14,-13.55,-13.83,-14.05,-14.29,-14.61,-15.08,
    -15.72,-16.56,-17.60,-18.84,-20.25,-21.79,-23.42,-25.10,-26.76,-28.36,-29.84,-31.15,-32.25,-33.12,-33.73,-34.07,-34.16,-34.01,-33.66,-33.15,-32.52,-31.81,
    -31.04,-30.25,-29.41,-28.49,-27.44,-26.16,-24.53,-22.41,-19.64,-16.07,-11.53,-5.910,0.9100,8.970,18.27,28.77,40.34,52.81,65.98,79.57,93.30,106.86,119.95,
    132.28,143.59,153.63,162.23,169.24,174.57,178.17,180.06,180.28,178.93,176.15,172.08,166.93,160.88,154.16,146.96,139.51,131.99,124.56,117.35,110.46,103.92,
    97.75,91.89,86.28,80.79,75.30,69.67,63.75,57.44,50.65,43.32,35.46,27.10,18.32,9.240,0,-9.240,-18.32,-27.10,-35.46,-43.32,-50.65,-57.44,-63.75,-69.67,-75.30,
    -80.79,-86.28,-91.89,-97.75,-103.92,-110.46,-117.35,-124.56,-131.99,-139.51,-146.96,-154.16,-160.88,-166.93,-172.08,-176.15,-178.93,-180.28,-180.06,-178.17,
    -174.57,-169.24,-162.23,-153.63,-143.59,-132.28,-119.95,-106.86,-93.30,-79.57,-65.98,-52.81,-40.34,-28.77,-18.27,-8.970,-0.9100,5.910,11.53,16.07,19.64,22.41,
    24.53,26.16,27.44,28.49,29.41,30.25,31.04,31.81,32.52,33.15,33.66,34.01,34.16,34.07,33.73,33.12,32.25,31.15,29.84,28.36,26.76,25.10,23.42,21.79,20.25,18.84,
    17.60,16.56,15.72,15.08,14.61,14.29,14.05,13.83,13.55,13.14,12.53,11.67,10.53,9.120,7.490,5.750,4.020,2.470,1.240,0.4400,0.06};


    /**
     * Constructor
    */
   jointPositions();

    /**
     * Update initial pos
    */
   void initialize_moveTo_constantPos(char mode, ODriveArduino *front_AB_ptr, ODriveArduino *front_HIP_ptr, ODriveArduino *front_KNEE_ptr,
   ODriveArduino *back_AB_ptr, ODriveArduino *back_HIP_ptr, ODriveArduino *back_KNEE_ptr);

//    /** 
//     * trace bspline - update
//     * @param bspline pointer to calculated control points
//     * @param time ellapsed time after t=0
//     * @return Desired joint_pos and joint_velo
//     */
//    struct update_bspline(bspline, time)
    
    /**
     * move to pos - update
     * @param elapsedSec time elapsed since the begining of the posture conversion (generated by millis)
    */
   void update_constantPos(float elapsedSec);

    /**
     * check if posture is reached
     * @return boolean value - whether the posture is reached
    */
   bool checkPos(char mode, ODriveArduino *front_AB_ptr, ODriveArduino *front_HIP_ptr, ODriveArduino *front_KNEE_ptr,
   ODriveArduino *back_AB_ptr, ODriveArduino *back_HIP_ptr, ODriveArduino *back_KNEE_ptr);

    /**
     * trace fixed traj - update
     * @param tick number of data tick
    */
   void update_traceTraj(int tick_fL, int tick_fR, int tick_bL, int tick_bR);

};